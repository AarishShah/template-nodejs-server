import { VulnerabilityService } from "../services/vulnerability.service.js";
import { catchError } from "../errors/catch-error.js";
import { ApiResponse } from "../utils/api-response.js";

export class VulnerabilityController {

    static getVulnerabilities = catchError(async (req, res, next) => {
        const page = parseInt(req.query.page) || 1;
        const limit = parseInt(req.query.limit) || 10;
        // Simple filters for demo
        const { severity, status } = req.query;
        const filters = {};
        if (severity) filters.severity = severity;
        if (status) filters.status = status;

        const result = await VulnerabilityService.getVulnerabilities({ page, limit, filters });
        return ApiResponse.success(res, result, "Vulnerabilities fetched successfully");
    });

    static createVulnerability = catchError(async (req, res, next) => {
        const data = await VulnerabilityService.createVulnerability(req.body);
        return ApiResponse.created(res, { data }, "Vulnerability created successfully");
    });

    static getVulnerabilityById = catchError(async (req, res, next) => {
        const { id } = req.params;
        const data = await VulnerabilityService.getVulnerabilityById(id);
        if (!data) {
            return ApiResponse.notFound(res, {}, "Vulnerability not found");
        }
        return ApiResponse.success(res, { data }, "Vulnerability fetched successfully");
    });
}
